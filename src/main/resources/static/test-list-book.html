<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test List Book</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Test List Book Functionality</h1>
        
        <div class="row">
            <div class="col-md-6">
                <h3>Step 1: Check Authentication</h3>
                <button id="checkAuth" class="btn btn-primary">Check if logged in</button>
                <div id="authResult" class="mt-2"></div>
            </div>
            
            <div class="col-md-6">
                <h3>Step 2: Test API Endpoint</h3>
                <button id="testAPI" class="btn btn-success">Test API (without auth)</button>
                <div id="apiResult" class="mt-2"></div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-12">
                <h3>Step 3: Manual Form Test</h3>
                <form id="testForm">
                    <div class="mb-3">
                        <label for="title" class="form-label">Title</label>
                        <input type="text" class="form-control" id="title" name="title" value="Test Book">
                    </div>
                    <div class="mb-3">
                        <label for="author" class="form-label">Author</label>
                        <input type="text" class="form-control" id="author" name="author" value="Test Author">
                    </div>
                    <div class="mb-3">
                        <label for="condition" class="form-label">Condition</label>
                        <select class="form-control" id="condition" name="condition">
                            <option value="Good">Good</option>
                            <option value="Excellent">Excellent</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="sharingType" class="form-label">Sharing Type</label>
                        <select class="form-control" id="sharingType" name="sharingType">
                            <option value="SWAP">Swap</option>
                            <option value="GIVE_AWAY">Give Away</option>
                            <option value="LEND">Lend</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="latitude" class="form-label">Latitude</label>
                        <input type="text" class="form-control" id="latitude" name="latitude" value="40.7128">
                    </div>
                    <div class="mb-3">
                        <label for="longitude" class="form-label">Longitude</label>
                        <input type="text" class="form-control" id="longitude" name="longitude" value="-74.0060">
                    </div>
                    <button type="submit" class="btn btn-warning">Submit Test Form</button>
                </form>
                <div id="formResult" class="mt-2"></div>
            </div>
        </div>
    </div>

    <script>
        // Check authentication
        document.getElementById('checkAuth').addEventListener('click', async () => {
            try {
                const response = await fetch('/api/current-user');
                const data = await response.json();
                document.getElementById('authResult').innerHTML = 
                    `<div class="alert alert-info">${JSON.stringify(data, null, 2)}</div>`;
            } catch (error) {
                document.getElementById('authResult').innerHTML = 
                    `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        });

        // Test API endpoint
        document.getElementById('testAPI').addEventListener('click', async () => {
            try {
                const formData = new URLSearchParams();
                formData.append('title', 'Test Book');
                formData.append('author', 'Test Author');
                formData.append('condition', 'Good');
                formData.append('sharingType', 'SWAP');
                formData.append('latitude', '40.7128');
                formData.append('longitude', '-74.0060');

                const response = await fetch('/books/api/list', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData.toString()
                });

                const result = {
                    status: response.status,
                    statusText: response.statusText,
                    redirected: response.redirected,
                    url: response.url
                };

                document.getElementById('apiResult').innerHTML = 
                    `<div class="alert alert-info">Response: ${JSON.stringify(result, null, 2)}</div>`;
            } catch (error) {
                document.getElementById('apiResult').innerHTML = 
                    `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        });

        // Test form submission
        document.getElementById('testForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                const formData = new URLSearchParams();
                const formElements = e.target.elements;
                
                for (let i = 0; i < formElements.length; i++) {
                    const element = formElements[i];
                    if (element.name && element.value) {
                        formData.append(element.name, element.value);
                    }
                }

                const response = await fetch('/books/api/list', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData.toString()
                });

                const result = {
                    status: response.status,
                    statusText: response.statusText,
                    redirected: response.redirected,
                    url: response.url
                };

                document.getElementById('formResult').innerHTML = 
                    `<div class="alert alert-info">Form Response: ${JSON.stringify(result, null, 2)}</div>`;
            } catch (error) {
                document.getElementById('formResult').innerHTML = 
                    `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        });
    </script>
</body>
</html> 