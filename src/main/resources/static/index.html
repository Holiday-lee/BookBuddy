<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/Other/html.html to edit this template
-->

<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Your neighbor personal library.">
        <meta name="keywords" content="library, give away book, book lending, book exchange, book swap, book swap app, book swap platforms, library app, nearby library, nearby books">
        <meta name="robots" content="index,follow">
        <meta name="googlebot" content="index,follow">

        <!-- Page Title & Favicon -->
        <title>BookBuddy - Your Neighborhood Personal Library</title>	
        <link rel="icon" href="/images/bookbuddy_logo.png" type="image/png">

        <!-- Add bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

        <!-- Add CSS sheet -->
        <link rel="stylesheet" href="/css/stylesheet.css">
        <link rel="stylesheet" href="/css/index.css">
    </head>

    <body>
    <!-- Simplified Dynamic Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top">
        <div class="container-fluid ms-3">
            <a class="navbar-brand" href="/">						
                <img src="/images/bookbuddy_logo.png" alt="Logo" height="80">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navMenu">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    
                    <!-- Homepage always visible for public -->
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/">Home</a>
                    </li>
                    
                    <!-- Search a Books always visible for public -->
                    <li class="nav-item">
                        <a class="nav-link" href="/pages/search-books.html">Search Books</a>
                    </li>
                    
                    <!--THESE FEATURES ONLY WILL BE VISIBLE AFTER LOGIN with extra remark class="nav-item auth-required"-->
                    
                    <!-- List a Book -->
                    <li class="nav-item auth-required" style="display: none;">
                        <a class="nav-link" href="/pages/list-book.html">List a Book</a>
                    </li>
                    
                    <!-- My Received Requests -->
                    <li class="nav-item auth-required" style="display: none;">
                        <a class="nav-link position-relative" href="/pages/my-received-requests.html">
                            My Received Requests
                            <span id="received-requests-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none; font-size: 0.6em;">0</span>
                        </a>
                    </li>
                    
                    <!-- My Sent Requests -->
                    <li class="nav-item auth-required" style="display: none;">
                        <a class="nav-link position-relative" href="/pages/my-sent-requests.html">
                            My Sent Requests
                            <span id="sent-requests-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none; font-size: 0.6em;">0</span>
                        </a>
                    </li>
                    
                    <!-- Chat -->
                    <li class="nav-item auth-required" style="display: none;">
                        <a class="nav-link position-relative" href="/pages/chat.html">Chat<span id="chat-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none; font-size: 0.6em;">0</span></a>
                    </li>
                    

                </ul>
                
                <!-- RIGHT SIDE USER MENU(Authentication buttons)-->
                <div class="d-flex">
                    
                    <!-- BEFORE LOGIN WILL SHOW AS -->
                    <div id="auth-buttons" class="auth-buttons">
                        <a href="/pages/login.html" class="btn btn-outline-primary me-2">Login</a>
                        <a href="/pages/register.html" class="btn btn-primary">Sign Up</a>
                    </div>
                    
                    <!-- AFTER LOGIN WILL SHOW AS -->
                    <div id="user-menu" class="auth-required dropdown" style="display: none;">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"> <!--dropdown-toggle=the little arrow//data-bs-toggle="dropdown =When clicked, open the dropdown menu connected to this button -->
                            <span id="user-name">User</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="/pages/profile.html">ðŸ‘¤ My Profile</a></li>
                            <li><a class="dropdown-item" href="/pages/my-books.html">ðŸ“š My Books</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/logout">ðŸšª Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Success/Error Messages -->
    <div class="container mt-3">
        <div id="flash-messages"></div>
    </div>

    <!-- Static Banner -->
    <div class="banner-container position-relative text-center">
        <a href="/pages/search-books.html" class="banner-link">
            <img src="/images/book-swap.png" class="img-fluid w-100" alt="BookBuddy Banner">
        </a>
    </div>

    <!-- About BookBuddy Section -->
    <section class="container my-5">
        <h2 class="text-center mb-4">About BookBuddy</h2>
        <p class="lead mb-3">
            BookBuddy is a community-powered web app that turns your personal book collection into a neighbor-friendly library. Whether you're ready to give a book away, lend it for a while, or swap it for something new, BookBuddy makes sharing books safe, simple, and local.
        </p>
        <p class="lead">
            Unlike traditional book-sharing platforms that rely on global shipping or impersonal exchanges, BookBuddy focuses on location-based, person-to-person interactions. Users list their books, choose how they want to share them, and coordinate pickup directly with others nearby. Itâ€™s a sustainable way to declutter your shelves, discover new reads, and build community connections.
        </p>
        <p class="lead">
            Whether you're a student, a passionate reader, or someone who just wants to share knowledge, BookBuddy helps you give, lend, or swap books â€” all on your terms.
        </p>
    </section>

    <!-- How It Works Section -->
    <section class="container my-5">
        <h2 class="text-center mb-4">How BookBuddy Works</h2>
        <div class="row row-cols-1 row-cols-md-2 g-4">
        
        <div class="col">
            <div class="card h-100 border-0">
            <div class="card-body">
                <h5 class="card-title">1. Sign Up and Create Your Profile</h5>
                <p class="card-text">Register easily with your email and set up your profile to start sharing and swapping books in your community.</p>
            </div>
            </div>
        </div>
        
        <div class="col">
            <div class="card h-100 border-0">
            <div class="card-body">
                <h5 class="card-title">2. List Your Books</h5>
                <p class="card-text">Add books to your virtual shelf and choose how you'd like to share them: Give Away â€“ Let someone take it for free. Lend â€“ Set a return period and lend it out. Swap â€“ Offer your book in exchange for one from another user. You'll also choose a pickup area to meet safely â€” no exact address required.</p>
            </div>
            </div>
        </div>
        
        <div class="col">
            <div class="card h-100 border-0">
            <div class="card-body">
                <h5 class="card-title">3. Find Books Nearby</h5>
                <p class="card-text">Use your location to search for books available around you. Filter by genre, title, or author, and discover what others are offering in your area.</p>
            </div>
            </div>
        </div>
        
        <div class="col">
            <div class="card h-100 border-0">
            <div class="card-body">
                <h5 class="card-title">4. Send a Request</h5>
                <p class="card-text">Interested in a book? Just send a request: For giveaways and loans, the owner can approve or decline. For swaps, you'll offer one of your own books in return. Once accepted, a chat opens for pickup planning.</p>
            </div>
            </div>
        </div>
        
        <div class="col">
            <div class="card h-100 border-0">
            <div class="card-body">
                <h5 class="card-title">5. Meet Up and Exchange</h5>
                <p class="card-text">Arrange a time to meet. After the exchange, users confirm the swap, return, or giveaway â€” and the book status updates automatically.</p>
            </div>
            </div>
        </div>
        
        <div class="col">
            <div class="card h-100 border-0">
            <div class="card-body">
                <h5 class="card-title">6. Complete the Swap and Enjoy Your Book</h5>
                <p class="card-text">Meet locally, exchange books, and dive into your new read! Track your swap history anytime and build connections with fellow book lovers.</p>
            </div>
            </div>
        </div>
        
        </div>
    </section>

    <!-- Footer -->
    <section class="bg-light text-dark">
        <div class="container mt-3">
          <div class="row g-4 justify-content-center">
            
            <!-- Follow us centered in full width -->
            <div class="col-12 text-center mb-5">
              <h5 class="category-heading">Follow us</h5>
              <div class="d-flex justify-content-center gap-4">
                <a href="https://www.facebook.com/NCIRL/" class="fuIcon">
                  <img src="/images/icons8-facebook-128.png" alt="facebook icon">
                </a>
                <a href="https://www.instagram.com/ncirl/" class="fuIcon">
                  <img src="/images/icons8-instagram-160.png" alt="instagram icon">
                </a>
                <a href="https://x.com/NCIRL" class="fuIcon">
                  <img src="/images/icons8-twitterx-144.png" alt="twitter icon">
                </a>
              </div>
            </div>
      
          </div>
          <div class="col-12 mt-2 pb-2 text-center text-light">
            &copy; 2025, BookBuddy
          </div>
        </div>
    </section>
    
    <!-- Bootstrap Script -->	
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    
    <!-- Notifications Script -->
    <script src="/js/notifications.js"></script>
    
    <!-- Authentication and Navigation Script -->
    <script>
        // Check authentication status and update navbar
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthenticationStatus();
            displayFlashMessages();
        });

        //  Checks if user is log in using an API end point
        //async + await fetch() =Wait for the fetch to finish getting data from the server before moving on to the next line.
        async function checkAuthenticationStatus(){
            try{
                //The credentials:'include' ensures cookies (like a session token) are sent along, important for auth.
                const response = await fetch('/api/current-user', { credentials: 'include' }); // call API endpoint on the server
                if (response.ok){
                    const user = await response.json(); // the endpoint return in json
                    if(user && user.authenticated){ // if user is logged in 
                        showAuthenticatedNavbar(user); // run this method 
                    }else{
                        showPublicNavbar(); //run this only show public navbar
                    }
                }else{
                    showPublicNavbar();
                }
            }catch(error){
                console.error('Error checking authentication:', error);
                showPublicNavbar();
            }
        }

        // after logged in view navbar & right side user info menu 
        function showAuthenticatedNavbar(user) {
            // Hide login/signup buttons
            document.getElementById('auth-buttons').style.display='none';
            
            // Show authenticated navbar items
            document.querySelectorAll('.auth-required').forEach(item => {
                item.style.display='block';
            });
            
            // Show user menu
            document.getElementById('user-menu').style.display='block';
            
            // Update user name
            document.getElementById('user-name').textContent=user.firstName || 'User';
            
            // Initialize notifications
            if (window.notifications){
                window.notifications.initNotifications();
            }
        }

        // Shows login/sign up buttons if not log in.
        function showPublicNavbar(){
            // Show login/signup buttons
            document.getElementById('auth-buttons').style.display = 'flex'; //if use Block, they will bcome 2 rows, not next to each other
            
            // Hide authenticated features
            const authRequired = document.querySelectorAll('.auth-required');
            authRequired.forEach(element =>{
                element.style.display = 'none';
            });
        }

        // shows success/error URL messages 
        function displayFlashMessages(){
            const urlParams = new URLSearchParams(window.location.search);
            const flashContainer = document.getElementById('flash-messages');
            
            if(urlParams.get('success')){
                showFlashMessage('success', decodeURIComponent(urlParams.get('success')));
            }
            if(urlParams.get('error')){
                showFlashMessage('danger', decodeURIComponent(urlParams.get('error')));
            }
        }

        // Creates a message box for showing the messages
        function showFlashMessage(type, message) {
            const flashContainer = document.getElementById('flash-messages');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            flashContainer.appendChild(alertDiv);
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
    </script>
    </body>
</html>