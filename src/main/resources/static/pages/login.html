<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/Other/html.html to edit this template
-->

<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Your neighbor personal library.">
        <meta name="keywords" content="library, give away book, book lending, book exchange, book swap, book swap app, book swap platforms, library app, nearby library, nearby books">
        <meta name="robots" content="index,follow">
        <meta name="googlebot" content="index,follow">

        <!-- Page Title & Favicon -->
        <title>Login - BookBuddy</title>	
        <link rel="icon" href="/images/bookbuddy_logo.png" type="image/png">

        <!-- Add bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

        <!-- Add CSS sheet -->
        <link rel="stylesheet" href="/css/stylesheet.css">
        
    </head>

    <body>
        
        <!-- Main Content -->
        <div class="container">
            <!-- Flash Messages Container -->
            <div id="flash-messages" class="mt-3"></div>
            
            <!-- Login Form Container -->
            <div class="login-container">
                <!-- Logo Section -->
                <div class="logo-section">
                    <img src="/images/bookbuddy_logo.png" alt="BookBuddy Logo">
                    <h3 class="text-primary mb-2">Welcome Back!</h3>
                    <p class="text-muted">Sign in to your BookBuddy account</p>
                </div>
                
                <!-- Error Alert (Spring Security error handling) -->
                <div id="error-alert" class="alert alert-danger" style="display: none;" role="alert">
                    <strong>Login Failed!</strong> <span id="error-message">Invalid email or password. Please try again.</span>
                </div>
                
                <!-- Success Alert (for registration success, logout, etc.) -->
                <div id="success-alert" class="alert alert-success" style="display: none;" role="alert">
                    <strong>Success!</strong> <span id="success-message"></span>
                </div>
                
                <!-- Login Form (Spring Security format) -->
                <form method="post" action="/login" id="loginForm" novalidate>
                    <div class="mb-3">
                        <label for="username" class="form-label">Email Address</label>
                        <input type="email" 
                               class="form-control" 
                               id="username" 
                               name="username" 
                               placeholder="Enter your email address"
                               required
                               autocomplete="email">
                        <div class="invalid-feedback">
                            Please enter a valid email address.
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" 
                               class="form-control" 
                               id="password" 
                               name="password" 
                               placeholder="Enter your password"
                               required
                               autocomplete="current-password">
                        <div class="invalid-feedback">
                            Please enter your password.
                        </div>
                    </div>
                    

                    
                    <button type="submit" class="btn btn-success w-100">
                        <span class="login-text">Sign In</span>
                        <span class="spinner-border spinner-border-sm d-none ms-2" role="status" aria-hidden="true"></span>
                    </button>
                </form>
                
                <!-- Additional Links -->
                <div class="additional-links">
                    <p class="mb-0">Don't have an account? 
                        <a href="/pages/register.html" class="text-primary text-decoration-none fw-bold">Sign up here</a>
                    </p>
                </div>
                
                <div class="back-home">
                    <a href="/" class="text-muted text-decoration-none">
                        ‚Üê Back to Home
                    </a>
                </div>
            </div>
        </div>

        <!-- Bootstrap Script -->	
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        
        <!-- Login Page JavaScript -->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                handleUrlParameters();
                setupFormValidation();
                displayFlashMessages();
            });

            // Handle URL parameters for Spring Security responses
            function handleUrlParameters() {
                const urlParams = new URLSearchParams(window.location.search);
                
                // Check for Spring Security login error
                if (urlParams.get('error') === 'true') {
                    showError('Invalid email or password. Please try again.');
                }
                
                // Check for logout success
                if (urlParams.get('logout') === 'true') {
                    showSuccess('You have been logged out successfully.');
                }
                
                // Check for registration success
                if (urlParams.get('registered') === 'true') {
                    showSuccess('Registration successful! Please log in with your credentials.');
                }
            }

            // Setup form validation (client-side)
            function setupFormValidation() {
                const form = document.getElementById('loginForm');
                const emailInput = document.getElementById('username');
                const passwordInput = document.getElementById('password');

                form.addEventListener('submit', function(event) {
                    event.preventDefault();
                    event.stopPropagation();

                    let isValid = true;

                    // Validate email
                    if (!emailInput.value || !isValidEmail(emailInput.value)) {
                        emailInput.classList.add('is-invalid');
                        isValid = false;
                    } else {
                        emailInput.classList.remove('is-invalid');
                        emailInput.classList.add('is-valid');
                    }

                    // Validate password
                    if (!passwordInput.value || passwordInput.value.length < 1) {
                        passwordInput.classList.add('is-invalid');
                        isValid = false;
                    } else {
                        passwordInput.classList.remove('is-invalid');
                        passwordInput.classList.add('is-valid');
                    }

                    if (isValid) {
                        showLoadingState();
                        // Let Spring Security handle the form submission
                        form.submit();
                    }
                });

                // Real-time validation feedback
                emailInput.addEventListener('input', function() {
                    if (isValidEmail(this.value)) {
                        this.classList.remove('is-invalid');
                        this.classList.add('is-valid');
                    } else if (this.value.length > 0) {
                        this.classList.remove('is-valid');
                        this.classList.add('is-invalid');
                    }
                });

                passwordInput.addEventListener('input', function() {
                    if (this.value.length >= 1) {
                        this.classList.remove('is-invalid');
                        this.classList.add('is-valid');
                    } else {
                        this.classList.remove('is-valid');
                        this.classList.add('is-invalid');
                    }
                });
            }

            // Email validation helper
            function isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            // Show loading state during form submission
            function showLoadingState() {
                const submitBtn = document.querySelector('button[type="submit"]');
                const loginText = submitBtn.querySelector('.login-text');
                const spinner = submitBtn.querySelector('.spinner-border');
                
                loginText.textContent = 'Signing In...';
                spinner.classList.remove('d-none');
                submitBtn.disabled = true;
            }

            // Show error message
            function showError(message) {
                const errorAlert = document.getElementById('error-alert');
                const errorMessage = document.getElementById('error-message');
                
                errorMessage.textContent = message;
                errorAlert.style.display = 'block';
                
                // Hide success message if showing
                document.getElementById('success-alert').style.display = 'none';
                
                // Scroll to top to show error
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            // Show success message
            function showSuccess(message) {
                const successAlert = document.getElementById('success-alert');
                const successMessage = document.getElementById('success-message');
                
                successMessage.textContent = message;
                successAlert.style.display = 'block';
                
                // Hide error message if showing
                document.getElementById('error-alert').style.display = 'none';
                
                // Scroll to top to show success
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            // Display flash messages from URL parameters
            function displayFlashMessages() {
                const urlParams = new URLSearchParams(window.location.search);
                const flashContainer = document.getElementById('flash-messages');
                
                if (urlParams.get('success')) {
                    showFlashMessage('success', decodeURIComponent(urlParams.get('success')));
                }
                if (urlParams.get('error')) {
                    showFlashMessage('danger', decodeURIComponent(urlParams.get('error')));
                }
            }

            // Create flash message (using your existing function style)
            function showFlashMessage(type, message) {
                const flashContainer = document.getElementById('flash-messages');
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
                alertDiv.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                flashContainer.appendChild(alertDiv);
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    alertDiv.remove();
                }, 5000);
            }

            // Auto-hide alerts after 7 seconds
            setTimeout(function() {
                const alerts = document.querySelectorAll('.alert');
                alerts.forEach(alert => {
                    if (alert.style.display !== 'none') {
                        alert.style.display = 'none';
                    }
                });
            }, 7000);
        </script>
        
        <!-- Footer -->
        <section class="bg-light text-dark">
            <div class="container mt-3">
              <div class="row g-4 justify-content-center">
                
                <!-- Follow us centered in full width -->
                <div class="col-12 text-center mb-5">
                  <h5 class="category-heading">Follow us</h5>
                  <div class="d-flex justify-content-center gap-4">
                    <a href="https://www.facebook.com/NCIRL/" class="fuIcon">
                      <img src="/images/icons8-facebook-128.png" alt="facebook icon">
                    </a>
                    <a href="https://www.instagram.com/ncirl/" class="fuIcon">
                      <img src="/images/icons8-instagram-160.png" alt="instagram icon">
                    </a>
                    <a href="https://x.com/NCIRL" class="fuIcon">
                      <img src="/images/icons8-twitterx-144.png" alt="twitter icon">
                    </a>
                  </div>
                </div>
          
              </div>
              <div class="col-12 mt-2 pb-2 text-center text-light">
                &copy; 2025, BookBuddy
              </div>
            </div>
        </section>
    </body>
</html>